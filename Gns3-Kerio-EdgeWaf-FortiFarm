
Ø§ÛŒÙ† Ø³Ù†Ø§Ø±ÛŒÙˆ ØµØ±ÙØ§ Ù‡Ù… Ø¬Ù‡Øª ØªØ­Ù‚ÛŒÙ‚ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¨Ø¯ÙˆÙ† Ø®Ø±ÛŒØ¯ ØªØ¬Ù‡ÛŒØ² ÙÙˆØ±ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø¹Ø¨Ø§Øª Ù‡Ù… Ø§Ú©Ù†ÙˆÙ† Ú†Ú¯ÙˆÙ†Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ Ø±Ø§ Ù¾ÛŒØ¯Ù‡ Ø³Ø§Ø²ÛŒ Ú©Ù†ÛŒÙ…  Ú©Ù‡ ØªÙ‚Ø¯ÛŒÙ… Ø­Ø¶ÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ§Ø­Ø¯ Ø§Ù†ÙÙˆØ±Ù…Ø§ØªÛŒÚ© Ø´Ø±Ú©Øª ØµÙ†Ø§ÛŒØ¹ Ù„ÙØ§Ù Ø²Ø±ÛŒÙ† Ù…ÛŒÚ¯Ø±Ø¯Ø¯ Ø§Ù„Ø¨ØªÙ‡ Ø§ÛŒÙ† Ø³Ù†Ø§Ø°ÛŒÙˆ Ú©Ø§Ù…Ù„Ø§ ØªØ³ØªÛŒ Ùˆ Ø¨Ø§ Ø¢Ø¯Ø±Ø³Ù‡Ø§ÛŒ ÙØ±Ø¶ÛŒ Ø§Ø¬Ø±Ø§Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ú¯Ø±Ø¯ÛŒØ¯
Ù‡Ø¯Ù Ø¯Ø± Ø§ÛŒÙ† Ø³Ù†Ø§Ø±ÛŒÙˆ Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ú©Ù„ÛŒÙ‡ Ø´Ø¨Ú©Ù‡ Ù„ÙˆÚ©Ø§Ù„ Ø¯ÙØªØ± Ù…Ø±Ú©Ø²ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ù‡ Ø³Ø±ÙˆØ±Ù‡Ø§ Ø§Ø² Ù„Ø­Ø§Ø¸ Ø§Ù…Ù†ÛŒØªÛŒ Ù‡Ù†Ú¯Ø§Ù† Ø±ÙˆØªÛŒÙ†Ú¯ Ø¨ÛŒÙ† ØªØ±Ø§Ù†Ú© Ø´Ø¨Ú©Ù‡ Ø¯Ø§Ø®Ù„ÛŒ Ùˆ ØªØ±Ø§Ù†Ú© Ø´Ø¨Ú©Ù‡ Ø³Ø±ÙˆØ± ÙØ§Ø±Ù… Ú©Ù‡ Ù‡Ù… Ø§Ú©Ù†ÙˆÙ† Ù‡Ø± Ù¾ÙˆØ±Øª Ø³Ø±ÙˆØ± Ø´Ù…Ø§ Ù…Ø®ØªØµ Ø¨Ù‡ ÛŒÚ© ÙˆÛŒ Ù„Ù† Ø¨ÙˆØ¯Ù‡ Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø³ÙˆØ¦ÛŒÚ† Ù…ÛŒØ¨Ø§Ø´Ø° Ùˆ Ù‡Ù…Ú†Ù†ÛŒÙ† Ø´Ø¹Ø¨Ø§Øª Ø´Ù…Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©Ø±ÛŒÙˆ Ú©Ù†ØªØ±Ù„ Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø¢Ù† Ø´Ø¹Ø¨Ù‡ Ø¨ÙˆØ§Ø³Ø·Ù‡ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù…Ù† Ùˆ Ø¹Ø¨ÙˆØ± Ø§Ø² ÙØ§ÛŒØ±ÙˆØ§Ù„ ÙÙˆØ±ØªÛŒ ÙˆØ¨ Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø¨Ù„ÛŒØªÙ‡Ø§ÛŒ Ø¢Ù† Ø¨Ù‡ ÙÙˆØ±ØªÛŒ Ú¯ÛŒØª Ø³Ø±ÙˆØ±ÙØ§Ø±Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ù†Ù‡Ø§ÛŒØª Ø¨Ù‡ Ø³ÙˆØ¦ÛŒÚ† Ø³Ø±ÙˆØ±ÙØ§Ø±Ù… Ù…Ù†ØªÙ‡ÛŒ Ù…ÛŒÚ¯Ø±Ø¯Ø¯
ğŸ—ï¸ Ø·Ø±Ø§Ø­ÛŒ Ú©Ø§Ù…Ù„ Ù„Ø§Ø¨Ø±Ø§ØªÙˆØ§Ø± GNS3

ØªÙˆÙ¾ÙˆÙ„ÙˆÚ˜ÛŒ Ú©Ù„ÛŒ:

```
[ Kerio Control 1 ] ---(WAN1)---+
[ Kerio Control 2 ] ---(WAN2)---+---[ FortiWeb WAF ]---[ FortiGate Server Farm ]
[ Kerio Control 3 ] ---(WAN3)---+           |                    |
[ Kerio Control 4 ] ---(WAN4)---+     [ Internet Cloud ]    [ Core Switch 3750 ]
[ Kerio Control 5 ] ---(WAN5)---+           |                    |
                                      [ Captive Portal ]    [ Access Switch 3750 ]
```

---

ğŸ”§ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ø´Ø¨Ú©Ù‡

Û±. Ø¨Ø®Ø´ WAN Ùˆ Kerio Controls

Ø¢ÛŒÙ¾ÛŒâ€ŒØ¯Ù‡ÛŒ Kerio Controls:

```bash
# Kerio Control 1:
WAN IP: 109.20.10.10/24
LAN IP: 192.168.1.1/24

# Kerio Control 2:  
WAN IP: 109.20.10.11/24
LAN IP: 192.168.2.1/24

# Kerio Control 3:
WAN IP: 109.20.10.12/24
LAN IP: 192.168.3.1/24

# Kerio Control 4:
WAN IP: 109.20.10.13/24
LAN IP: 192.168.4.1/24

# Kerio Control 5:
WAN IP: 109.20.10.14/24
LAN IP: 192.168.5.1/24
```

Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Kerio Ø¨Ø±Ø§ÛŒ SD-WAN:

```bash
# Ø¯Ø± Ù‡Ø± Kerio - Traffic Rules Ø¨Ø±Ø§ÛŒ Load Balancing
Configuration > Traffic Rules > New Rule:
- Source: LAN Network
- Destination: Any  
- Service: Any
- Action: Allow + Load Balance
- Gateway: Multiple WANs (Weighted Round Robin)
```

Û². Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ FortiWeb WAF

Interfaces Configuration:

```bash
config system interface
    # WAN Interfaces Ø¨Ø±Ø§ÛŒ KerioÙ‡Ø§
    edit "port1"
        set vdom "root"
        set ip 109.20.10.1 255.255.255.0
        set type physical
    next
    edit "port2"
        set vdom "root" 
        set ip 109.20.10.2 255.255.255.0
        set type physical
    next
    edit "port3"
        set vdom "root"
        set ip 109.20.10.3 255.255.255.0
        set type physical
    next
    edit "port4"
        set vdom "root"
        set ip 109.20.10.4 255.255.255.0
        set type physical
    next
    edit "port5"
        set vdom "root"
        set ip 109.20.10.5 255.255.255.0
        set type physical
    next
    
    # Link Ø¨Ù‡ FortiGate Server Farm
    edit "port6"
        set vdom "root"
        set ip 10.255.255.1 255.255.255.252
        set type physical
    next
    
    # DMZ Interface
    edit "port7"
        set vdom "root"
        set ip 172.16.255.1 255.255.255.0
        set type physical
    next
end
```

SD-WAN Configuration Ø±ÙˆÛŒ FortiWeb:

```bash
config system sdwan
    set status enable
    config zone
        edit "kerio-wan-zone"
            set service-sla-tie-break latency
        next
    end
    
    # Member Interfaces
    config members
        edit 1
            set interface "port1"
            set zone "kerio-wan-zone"
            set cost 10
        next
        edit 2
            set interface "port2" 
            set zone "kerio-wan-zone"
            set cost 10
        next
        edit 3
            set interface "port3"
            set zone "kerio-wan-zone" 
            set cost 10
        next
        edit 4
            set interface "port4"
            set zone "kerio-wan-zone"
            set cost 10
        next
        edit 5
            set interface "port5"
            set zone "kerio-wan-zone"
            set cost 10
        next
    end
    
    # Health Check
    config health-check
        edit "Kerio-Link-Check"
            set server "8.8.8.8" "1.1.1.1"
            set members 1 2 3 4 5
            config sla
                edit 1
                    set latency-threshold 200
                next
            end
        next
    end
    
    # SD-WAN Rules
    config service
        edit 1
            set name "Web-Traffic"
            set dst "all"
            set src "109.20.10.0/24"
            set priority-zone "kerio-wan-zone"
            set use-shortcut-sla enable
        next
    end
end
```

Û³. Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ FortiGate Server Farm

Interfaces Configuration:

```bash
config system interface
    # Link Ø§Ø² FortiWeb
    edit "port1"
        set vdom "root"
        set ip 10.255.255.2 255.255.255.252
        set type physical
    next
    
    # Trunk Ø¨Ù‡ Core Switch 3750
    edit "port2"
        set vdom "root"
        set type aggregate
        set member "port2" "port3"
        set lacp-mode static
    next
    
    # Trunk Ø¨Ù‡ Access Switch 3750  
    edit "port4"
        set vdom "root"
        set type aggregate
        set member "port4" "port5"
        set lacp-mode static
    next
end
```

VLAN Configuration Ø±ÙˆÛŒ FortiGate:

```bash
config system interface
    # VLANÙ‡Ø§ÛŒ Ø³Ø±ÙˆØ±ÙØ§Ø±Ù… (100-105)
    edit "vlan100"
        set vdom "root"
        set interface "aggregate1"
        set vlanid 100
        set ip 192.168.100.1 255.255.255.0
    next
    edit "vlan101"
        set vdom "root"
        set interface "aggregate1"
        set vlanid 101
        set ip 192.168.101.1 255.255.255.0
    next
    edit "vlan102"
        set vdom "root"
        set interface "aggregate1"
        set vlanid 102
        set ip 192.168.102.1 255.255.255.0
    next
    edit "vlan103"
        set vdom "root"
        set interface "aggregate1"
        set vlanid 103
        set ip 192.168.103.1 255.255.255.0
    next
    edit "vlan104"
        set vdom "root"
        set interface "aggregate1"
        set vlanid 104
        set ip 192.168.104.1 255.255.255.0
    next
    edit "vlan105"
        set vdom "root"
        set interface "aggregate1"
        set vlanid 105
        set ip 192.168.105.1 255.255.255.0
    next
    
    # VLANÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (10-20)
    edit "vlan10"
        set vdom "root"
        set interface "aggregate2"
        set vlanid 10
        set ip 172.16.10.1 255.255.255.0
    next
    edit "vlan11"
        set vdom "root"
        set interface "aggregate2"
        set vlanid 11
        set ip 172.16.11.1 255.255.255.0
    next
    # ... ØªØ§ vlan20
end
```

Û´. Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Cisco Catalyst 3750 Core Switch

EtherChannel Configuration:

```bash
! Interface Ø¨Ø±Ø§ÛŒ FortiGate
interface Port-channel1
 description FortiGate Server Farm Trunk
 switchport mode trunk
 switchport trunk native vlan 999
 switchport trunk allowed vlan 100-105
 spanning-tree portfast trunk
!
interface GigabitEthernet1/0/1
 description FortiGate Port2
 channel-group 1 mode active
!
interface GigabitEthernet1/0/2  
 description FortiGate Port3
 channel-group 1 mode active
```

VLAN Configuration:

```bash
! VLANÙ‡Ø§ÛŒ Ø³Ø±ÙˆØ±ÙØ§Ø±Ù…
vlan 100
 name Server-Farm-100
vlan 101
 name Server-Farm-101  
vlan 102
 name Server-Farm-102
vlan 103
 name Server-Farm-103
vlan 104
 name Server-Farm-104
vlan 105
 name Server-Farm-105
```

Ûµ. Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Active Directory (keivan.local)

Ø±ÙˆÛŒ Windows Server:

```powershell
# Ù†ØµØ¨ Active Directory
Install-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools

# Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ù…Ù†Ù‡ Ø¬Ø¯ÛŒØ¯
Install-ADDSForest -DomainName "keivan.local" -DomainNetbiosName "KEIVAN" -Force

# Ø§ÛŒØ¬Ø§Ø¯ UserÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªØ³Øª
New-ADUser -Name "testuser1" -AccountPassword (ConvertTo-SecureString "Password123!" -AsPlainText -Force) -Enabled $true
```

Û¶. Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Captive Portal Ø±ÙˆÛŒ FortiGate

```bash
config user setting
    set auth-type captive
    set auth-portal-message "Welcome to Keivan.local Network"
end

config user captive-portal
    edit "Main-Portal"
        set idle-timeout 300
        set pre-login-bypass disable
        set theme green
        set page-layout double
        config excluded-ranges
            edit 1
                set ip 172.16.10.0 255.255.255.0
            next
        end
    next
end
```

Û·. Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ DMZ Ø±ÙˆÛŒ FortiWeb

```bash
config system zone
    edit "DMZ-Zone"
        set interface "port7"
        set intrazone-allow allow
    next
end

config firewall policy
    edit 1
        set name "Kerio-to-DMZ"
        set srcintf "port1" "port2" "port3" "port4" "port5"
        set dstintf "port7" 
        set srcaddr "109.20.10.0/24"
        set dstaddr "DMZ-Servers"
        set action accept
        set schedule "always"
        set service "ALL"
        set nat enable
    next
end
```

---

ğŸ¯ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ³Øª Ùˆ Validation

ØªØ³Øª Û±: SD-WAN Load Balancing

```bash
# Ø§Ø² Kerio ControlÙ‡Ø§:
ping -t 8.8.8.8
tracert 8.8.8.8

# Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø±ÙˆÛŒ FortiWeb:
get system sdwan health-check
get system sdwan service
```

ØªØ³Øª Û²: VLAN Routing

```bash
# Ø§Ø² VLAN 100 Ø¨Ù‡ VLAN 10:
ping 172.16.10.10 source 192.168.100.10

# Ø¨Ø±Ø±Ø³ÛŒ routing table:
get router info routing-table all
```

ØªØ³Øª Û³: LDAP Authentication

```bash
# ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ AD:
diagnose test application authd 1
config user ldap
edit "keivan-ldap"
    set server "192.168.100.10"
    set cnid "sAMAccountName"
    set dn "DC=keivan,DC=local"
    set type regular
    set username "administrator"
    set password "YourADPassword"
next
end
```

ØªØ³Øª Û´: Captive Portal

```bash
# Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ø±Ø¨Ø±:
curl -I http://google.com
# Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ captive portal redirect Ø´ÙˆØ¯

# Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯:
diagnose debug application fnbamd -1
diagnose debug enable
```

---

ğŸ“Š Ø¯Ø§Ú©ÛŒÙˆÙ…Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ

Û±. Network Diagram (Ø¯Ø± Mermaid):

```mermaid
graph TB
    KC1[Kerio Control 1] --> FW[FortiWeb WAF]
    KC2[Kerio Control 2] --> FW
    KC3[Kerio Control 3] --> FW  
    KC4[Kerio Control 4] --> FW
    KC5[Kerio Control 5] --> FW
    
    FW --> FGF[FortiGate Server Farm]
    
    FGF --> CSW[Core Switch 3750]
    FGF --> ASW[Access Switch 3750]
    
    CSW --> V100[VLAN 100: 192.168.100.0/24]
    CSW --> V101[VLAN 101: 192.168.101.0/24]
    CSW --> V105[VLAN 105: 192.168.105.0/24]
    
    ASW --> V10[VLAN 10: 172.16.10.0/24]
    ASW --> V11[VLAN 11: 172.16.11.0/24]
    ASW --> V20[VLAN 20: 172.16.20.0/24]
    
    FW --> DMZ[DMZ Zone]
    FW --> INTERNET[Internet Cloud]
    
    INTERNET --> CP[Captive Portal]
```

Û². Configuration Files:

Â· FortiWeb WAF Config
Â· FortiGate Server Farm Config
Â· Cisco Switch Configs
Â· Kerio Control Templates
Â· GNS3 Project File

Û³. ØªØ³Øª Ù¾Ù„Ù† Ú©Ø§Ù…Ù„:

Â· Connectivity Tests
Â· Performance Tests
Â· Security Tests


Â· Kerio Control (OVA ÛŒØ§ QCOW2)
Â· FortiWeb WAF (QCOW2 Ø§Ø² Ø³Ø§ÛŒØª ÙÙˆØ±ØªÛŒâ€ŒÙ†Øª)
Â· FortiGate (Ø¨Ø±Ø§ÛŒ Ø³Ø±ÙˆØ±ÙØ§Ø±Ù…)
Â· Cisco IOS (Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ¦ÛŒÚ†â€ŒÙ‡Ø§ÛŒ 3750)
Â· Windows Server (Ø¨Ø±Ø§ÛŒ Active Directory)
Â· Linux/Windows (Ø¨Ø±Ø§ÛŒ Ú©Ù„Ø§ÛŒÙ†Øªâ€ŒÙ‡Ø§ÛŒ ØªØ³Øª)

